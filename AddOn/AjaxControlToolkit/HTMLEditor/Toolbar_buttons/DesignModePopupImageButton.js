Type.registerNamespace("AjaxControlToolkit.HTMLEditor.ToolbarButton");AjaxControlToolkit.HTMLEditor.ToolbarButton.DesignModePopupImageButton=function(b){var a=this;AjaxControlToolkit.HTMLEditor.ToolbarButton.DesignModePopupImageButton.initializeBase(a,[b]);a._relatedPopup=null;a._autoClose=true;a._forclose_onmousedown$delegate=null};AjaxControlToolkit.HTMLEditor.ToolbarButton.DesignModePopupImageButton.prototype={set_activeEditPanel:function(b){var a=this;if(a._editPanel!=b&&a._editPanel!=null)a.closePopup();AjaxControlToolkit.HTMLEditor.ToolbarButton.DesignModePopupImageButton.callBaseMethod(a,"set_activeEditPanel",[b])},get_autoClose:function(){return this._autoClose},set_autoClose:function(a){this._autoClose=a},get_relatedPopup:function(){return this._relatedPopup},set_relatedPopup:function(a){this._relatedPopup=a},openPopup:function(h,j,i){var c=null,a=this;if(a._autoClose&&a._forclose_onmousedown$delegate!=c)return;if(a._relatedPopup!=c){a._bookmark=c;if(AjaxControlToolkit.HTMLEditor.isIE){var e=a._designPanel._getSelection();a._selType=e.type.toLowerCase();var d=a._designPanel._createRange(e);if(a._selType=="text"||a._selType=="none")try{a._bookmark=d.duplicate()}catch(k){}else if(a._selType=="control"){a._bookmark=d.item(0);d.remove(0);e.empty()}}if(typeof a._relatedPopup.set_relatedElement=="function"){a._relatedPopup.set_relatedElement(a.get_element());a._forclose_onmousedown$delegate=Function.createDelegate(a,a._forclose_onmousedown);if(a._autoClose){var f=a._designPanel.get_element().contentWindow,g=f.document.body,b=a;setTimeout(function(){var a="mousedown";if(b._forclose_onmousedown$delegate!=c){AjaxControlToolkit.HTMLEditor._addEvent(g,a,b._forclose_onmousedown$delegate);AjaxControlToolkit.HTMLEditor._addEvent(g,"keydown",b._forclose_onmousedown$delegate);AjaxControlToolkit.HTMLEditor._addEvent(document.body,"keydown",b._forclose_onmousedown$delegate);AjaxControlToolkit.HTMLEditor._addEvent(f,a,b._forclose_onmousedown$delegate);AjaxControlToolkit.HTMLEditor._addEvent(document.body,a,b._forclose_onmousedown$delegate);if(document.documentElement)AjaxControlToolkit.HTMLEditor._addEvent(document.documentElement,a,b._forclose_onmousedown$delegate)}},0)}a._relatedPopup.open(h)}else a._relatedPopup.open(h,j,i)}},_forclose_onmousedown:function(){var c="mousedown",a=this;if(a._forclose_onmousedown$delegate==null)return true;if(a._relatedPopup.isOpened)a._relatedPopup.close();else return;if(a._editPanel==AjaxControlToolkit.HTMLEditor.LastFocusedEditPanel)try{if(a._bookmark){if(AjaxControlToolkit.HTMLEditor.isIE){var b;if(a._selType=="control"){b=a._designPanel._doc.body.createControlRange();b.add(a._bookmark)}else b=a._bookmark;b.select()}a._bookmark=null}if(!AjaxControlToolkit.HTMLEditor.isIE){var d=a._designPanel._getSelection(),b=a._designPanel._createRange(d);a._designPanel._removeAllRanges(d);a._designPanel._selectRange(d,b);a._designPanel.focusEditor()}}catch(h){}var g=a;setTimeout(function(){if(g._editPanel==AjaxControlToolkit.HTMLEditor.LastFocusedEditPanel)try{g._editPanel.updateToolbar()}catch(a){}},0);if(a._autoClose)try{var e=a._designPanel.get_element().contentWindow,f=e.document.body;if(document.documentElement)AjaxControlToolkit.HTMLEditor._removeEvent(document.documentElement,c,a._forclose_onmousedown$delegate);AjaxControlToolkit.HTMLEditor._removeEvent(f,"keydown",a._forclose_onmousedown$delegate);AjaxControlToolkit.HTMLEditor._removeEvent(document.body,"keydown",a._forclose_onmousedown$delegate);AjaxControlToolkit.HTMLEditor._removeEvent(f,c,a._forclose_onmousedown$delegate);AjaxControlToolkit.HTMLEditor._removeEvent(e,c,a._forclose_onmousedown$delegate);AjaxControlToolkit.HTMLEditor._removeEvent(document.body,c,a._forclose_onmousedown$delegate)}catch(h){}a._forclose_onmousedown$delegate=null},closePopup:function(){if(this._forclose_onmousedown$delegate!=null)this._forclose_onmousedown$delegate(null)},dispose:function(){if(this._forclose_onmousedown$delegate!=null)this._forclose_onmousedown$delegate(null);AjaxControlToolkit.HTMLEditor.ToolbarButton.DesignModePopupImageButton.callBaseMethod(this,"dispose")}};AjaxControlToolkit.HTMLEditor.ToolbarButton.DesignModePopupImageButton.registerClass("AjaxControlToolkit.HTMLEditor.ToolbarButton.DesignModePopupImageButton",AjaxControlToolkit.HTMLEditor.ToolbarButton.MethodButton);